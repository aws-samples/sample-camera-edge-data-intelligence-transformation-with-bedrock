# Quick Start RTSP Camera

本ドキュメントでは RTSP のカメラからの映像取り込み、およびAIによる映像解析までのセットアップ、その検出結果の分析までの一連のセットアップ手順を記載します。

> 📝 **注意**: 本セットアップは、「AWSからRTSPカメラに直接ネットワーク的に接続可能なケース」のセットアップを想定しています。

---

## Place を作成する

ヘッダーの場所をクリック。ADD ボタンを押します

![1770694015828.png](../image/1770694015828.png)

名前を入れてSAVEを押します

![1770694039382.png](../image/1770694039382.png)

---

## テスト動画をアップロードする（疑似的なRTSPカメラを起動する）

ヘッダーのテスト動画をクリックする。CREATE NEW をクリック

![1770694056841.png](../image/1770694056841.png)

名前を入れて、動画をアップロードしてCREATE

![1770694160300.png](../image/1770694160300.png)

> 📝 アップロードする動画について
> 推奨は3分以上のやや長めの動画がお勧めです。1分未満の動画は非推奨です。
> 1分の動画を利用すると、都度、Reciver側で再接続して映像ソースを引っ張る処理をする都合にて、切断時間が一定発生することになり、最終的に Connector で映像記録すると 40-50秒の動画しか切り取れなくなる問題があるためです。
> なお、本来のRTSPソースは基本的に切断ないため、こういった問題は発生しません。


作成されるので、RTSP URLをコピー

![1770694176794.png](../image/1770694176794.png)

---

## Camera と接続する

カメラ画面にて、CONNECT CAMERAをクリック

![1770694215288.png](../image/1770694215288.png)

名前と場所を入れて、Camera Endpoint にてRTSPを選択。先程コピーしたRTSP URLを貼り付けて、SAVEボタンを押す。カメラ作成中のメッセージがでるため完了するまで待機する。CloudFormation でのデプロイのため一定時間かかります。

![1770694440021.png](../image/1770694440021.png)

成功するとカメラ一覧に表示されるのでクリックしてください

![1770694745485.png](../image/1770694745485.png)

LIVE 画面に映像がでていたら接続成功です。

![1770713854778.png](../image/1770713854778.png)

---

## Collectorを追加する (Recorder)

カメラを編集で開き、ADD COLLECTORをクリック。

> 📝 **注意**: これはOptionですのでマストの作業ではありません。

![1770695569362.png](../image/1770695569362.png)

hlsRec コレクターを選択し、モードは「画像+動画」としてSAVEをクリック

![1770695606099.png](../image/1770695606099.png)

コレクターは CloudFormation でのデプロイのため一定時間かかります。状況を見たい場合は、コレクターをEditで開くと確認出来ます。

![1770695676911.png](../image/1770695676911.png)

![1770695848059.png](../image/1770695848059.png)

---

## Collectorを追加する (Yolo Detection)

hslYolo コレクターを選択し、モードは画像を選択ください（動画は選択できません）。その上で、検出設定を行います。

↓の例では、エリアの侵入/退出を検出する設定を行っています。

| 設定項目 | 推奨値 |
| --- | --- |
| イベント発生条件 | エリア侵入・退出のみ |
| エリア判定 | バウンディングボックス判定 |
| エリア検出判定方法 | 数の増減で判定（現状はこれが推奨） |

また、EDIT AREA にてエリアを設定します。そして、YOLO Modelを選択します。現状は CPU環境での実行となっているのでv9-s のような小さいモデルを指定ください。

> 📝 **ヒント**: ご自身で学習も可能で、学習したモデルは `shared/yolo_detector/yolo` 以下に重みと一緒に配置ください。

> 📝 **注意**: これはOptionですのでマストの作業ではありません。

![1770696052544.png](../image/1770696052544.png)

**エリアの設定画面** (クリックで領域指定）

![1770714037383.png](../image/1770714037383.png)

---

## Collectorを確認する (Recorder)

カメラを選択して、IMAGEタブを選択します。さらに、Collectorのセレクトボックスで、hlsRec を選択。以下のように切り出された画像が時系列に表示されていれば成功です。

![1770713914735.png](../image/1770713914735.png)

同じようにVIDEOタブを選択し、CollectorでhlsRecを選択ください。動画が記録されていれば成功です。

![1770713969591.png](../image/1770713969591.png)

---

## Collectorを確認する (Yolo Detection)

カメラを選択して、IMAGEタブを選択します。さらに、Collectorのセレクトボックスで、hlsYolo を選択し、Detectorにて「collector-internal」を選択。左上で「DETECTION」タブを選択し、「DETECTION RESULT」ボタンを押して、右サイドパネルを開きます。すると↓のような画面となります。

エリアの侵入、退出のタイミングで画像が生成され、RESULTにてその検出結果の詳細を確認できます。

![1770713609675.png](../image/1770713609675.png)

**[他パターンの例]**

![1770696803935.png](../image/1770696803935.png)

---

## Detector を Collectorに追加する

カメラを編集で開き、先程追加した hlsYolo コレクターにある「ADD DETECTOR」をクリック。

> 📝 **注意**: これはOptionですのでマストの作業ではありません。

> 📝 **ヒント**: hlsYoloコレクターを使わず、hlsRecコレクターにDETECTORを設定しても問題ありません。違いは hlsRecの場合、全ての画像/動画に対してDETECTORを実行する一方で、hlsYoloの場合、Yoloでクラス検出/エリア侵入・退出した時だけDETECTORを実行します。

![1770697066596.png](../image/1770697066596.png)

ファイルタイプは「画像」、トリガーイベントは「AreaDetectEvent」を選択ください (今回、hlsYoloにてエリアでの侵入/退出検出を選択したためAreaDetectEventとしていますが、hlsRecの場合はSaveImageEvent/VideImageEventをご選択ください)。

その上で、このカメラの役割と検出させたいことをプロンプトで記載ください。

> 📝 **重要**: 検出結果をタグとして登録するには、事前にタグ管理画面にて検出したいタグを登録しておき、ADD TAGで呼び出す形で登録する必要があります。

![1770700968173.png](../image/1770700968173.png)

![1770716077947.png](../image/1770716077947.png)

登録すると、以下のように 「bedrock」 Detectorとして登録されます。

![1770701183404.png](../image/1770701183404.png)

---

## Detectorを確認する

カメラを選択して、IMAGEタブを選択します。さらに、Collectorのセレクトボックスで、hlsYolo を選択し、Detectorにて「bedrock」を選択。

左上の「DETECTION RESULT」ボタンを押して、右サイドパネルを開きます。すると↓のような画面となります。

指示の内容に従って検出が実行されます。ヒットするタグがある場合、検出されたタグも確認できます。

![1770713550978.png](../image/1770713550978.png)

---

## Notify について

通知すべき内容が検出された場合、右上のベルマークが赤くなります。クリックすると最新の通知内容を確認出来ます。

![1770712031046.png](../image/1770712031046.png)

---

## Insight 分析について

タグが時系列で何件発生しているか？視覚的に確認できます。

![1770713705171.png](../image/1770713705171.png)

![1770713722451.png](../image/1770713722451.png)

---

## Full-text Searchについて

キーワードを入れてのフルテキスト検索が出来ます。その際、場所やカメラやタグ、検出時間などを絞り込むことも可能です。

![1770714226917.png](../image/1770714226917.png)

---

## Bookmark & Reportingについて

気になる画像や動画があった場合、右上の ADD BOOKMARKボタンを押します。

![1770716146918.png](../image/1770716146918.png)

すると、ブックマーク登録画面が表示されるため、保存先を選択/作成します。

![1770716128553.png](../image/1770716128553.png)

ブックマーク管理画面より保存したブックマークを確認出来ます。

![1770716232979.png](../image/1770716232979.png)

更に、右上のCREATE REPORT ボタンを押すと、ブックマークした画像/動画の検出情報を元にしたレポート作成が行えます。レポートの内容はプロンプトで指定可能です。

![1770716444350.png](../image/1770716444350.png)
